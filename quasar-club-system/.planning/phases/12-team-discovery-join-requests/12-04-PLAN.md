---
phase: 12-team-discovery-join-requests
plan: "04"
type: execute
wave: 3
depends_on: ["12-02", "12-03"]
files_modified:
  - src/pages/TeamsPage.vue
  - src/components/TeamComponent.vue
  - src/pages/SettingsPage.vue
  - src/i18n/en-US/index.ts
  - src/i18n/cs-CZ/index.ts
autonomous: false
requirements:
  - DISC-01
  - DISC-02
  - DISC-03
  - DISC-04
  - DISC-05

must_haves:
  truths:
    - "A standalone /teams page shows the team browse list with filtering and join request actions"
    - "Power users see a join request management section on the teams page"
    - "Users can view their past and pending join requests in a 'My Requests' section in Settings"
    - "The complete flow works end-to-end: browse → request → approve → user becomes member"
  artifacts:
    - path: "src/components/TeamComponent.vue"
      provides: "Updated teams page with browse list and join request management sections"
      contains: "TeamBrowseList"
    - path: "src/pages/SettingsPage.vue"
      provides: "My Requests section showing user's join request history"
      contains: "myRequests"
  key_links:
    - from: "src/components/TeamComponent.vue"
      to: "src/components/onboarding/TeamBrowseList.vue"
      via: "reuses browse list component"
      pattern: "TeamBrowseList"
    - from: "src/components/TeamComponent.vue"
      to: "src/components/team/JoinRequestManagement.vue"
      via: "includes management component for power users"
      pattern: "JoinRequestManagement"
---

<objective>
Wire the standalone /teams page with browse list + request management, add "My Requests" to settings, and verify the complete end-to-end flow.

Purpose: Completes all DISC requirements by making team browsing available outside onboarding, adding request history visibility, and verifying the full lifecycle.

Output: Complete team discovery and join request feature fully integrated across the app.
</objective>

<execution_context>
@C:/Users/Developer/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-team-discovery-join-requests/12-CONTEXT.md
@.planning/phases/12-team-discovery-join-requests/12-02-SUMMARY.md
@.planning/phases/12-team-discovery-join-requests/12-03-SUMMARY.md
@src/pages/TeamsPage.vue
@src/components/TeamComponent.vue
@src/pages/SettingsPage.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update TeamsPage/TeamComponent with browse list and request management, add My Requests to Settings</name>
  <files>
    src/components/TeamComponent.vue
    src/pages/SettingsPage.vue
    src/i18n/en-US/index.ts
    src/i18n/cs-CZ/index.ts
  </files>
  <action>
**1. Update `src/components/TeamComponent.vue`:**

The existing TeamComponent currently renders the teams page. Enhance it to include:

a) A "Browse Teams" section using the reusable `TeamBrowseList` component from plan 02. Import and render `<TeamBrowseList />` in a `q-card` section with a header.

b) A "Join Request Management" section for power users. Import `JoinRequestManagement` from plan 03. Conditionally render when user is a power user of the current team:
```html
<JoinRequestManagement v-if="isPowerUser" />
```

Where `isPowerUser` is computed from `teamStore.currentTeam?.powerusers?.includes(authStore.user?.uid)`.

c) Keep any existing team content (team list, team details) intact — add the browse and management sections alongside existing content.

Layout suggestion: Use `q-card` sections with `q-card-section` headers. Put JoinRequestManagement first (if power user) since it needs attention, then Browse Teams below, then existing team content.

**2. Update `src/pages/SettingsPage.vue`:**

Add a "My Requests" section that shows the user's join request history. Per CONTEXT.md: "Requesting user has a 'My Requests' section (in settings or profile) showing pending and past requests with status." Claude's discretion placed it in Settings.

- Import `useJoinRequestUseCases` and `IJoinRequest`
- In `onMounted`, call `setUserJoinRequestsListener` to get user's requests
- In `onUnmounted`, unsubscribe the listener
- Add a `q-card` section titled "My Requests" (i18n) after existing settings content
- Render a `q-list` of requests:
  - Each `q-item` shows: team name, status badge (color-coded: pending=warning, approved=positive, declined=negative, cancelled=grey), date
  - For pending requests: show a "Cancel" button that calls `cancelJoinRequest(request.id)`
  - Empty state: "No join requests" message
- Use `q-badge` for status display:
  - pending: color="warning"
  - approved: color="positive"
  - declined: color="negative"
  - cancelled: color="grey"

**3. Add i18n translations:**

Add a `myRequests` block in both language files:

English:
```
myRequests: {
  title: 'My Join Requests',
  noRequests: 'No join requests yet',
  cancel: 'Cancel',
  status: {
    pending: 'Pending',
    approved: 'Approved',
    declined: 'Declined',
    cancelled: 'Cancelled'
  },
  cancelConfirm: 'Cancel this join request?',
  cancelled: 'Request cancelled'
}
```

Czech:
```
myRequests: {
  title: 'Moje zadosti o prirazeni',
  noRequests: 'Zatim zadne zadosti',
  cancel: 'Zrusit',
  status: {
    pending: 'Cekajici',
    approved: 'Schvalena',
    declined: 'Zamitnuta',
    cancelled: 'Zrusena'
  },
  cancelConfirm: 'Zrusit tuto zadost?',
  cancelled: 'Zadost zrusena'
}
```

Use proper Czech diacritics.
  </action>
  <verify>
Run `npx tsc --noEmit 2>&1 | head -30`. Verify TeamComponent.vue imports TeamBrowseList and JoinRequestManagement. Verify SettingsPage.vue has My Requests section. Run `quasar dev` and check the /teams page renders.
  </verify>
  <done>TeamsPage shows browse list for all users and request management for power users. Settings page shows My Requests with status badges and cancel action. All text internationalized.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify complete join request flow end-to-end</name>
  <action>
Human verification checkpoint. What was built:
- Team browse list in onboarding wizard step 3 (browse path)
- Team browse list on standalone /teams page
- Join request send with confirmation dialog
- Power user sidebar badge for pending requests
- Join request management with approve/decline
- My Requests history in Settings
- Audit logging for approve/decline

How to verify:

**Test as a teamless user (or use a second account):**
1. Navigate to /onboarding then step 3 then choose Browse then verify team list loads with search filter
2. Tap a team then verify confirmation dialog appears then Send then verify toast "Join request sent"
3. Verify "Request Pending" badge appears on that team, join button disabled
4. Cancel the request then verify badge changes back to "Join" button
5. Send another request to test the flow

**Test as a power user of the target team:**
6. Check sidebar: "Teams" link should show red badge with pending count
7. Navigate to /teams then verify "Join Requests" section shows the request with name + email
8. Click Approve then verify toast, user disappears from pending list
9. (Optional) Send another request from test user then Decline it then verify request disappears without adding member

**Test My Requests:**
10. As the requesting user, go to Settings then verify "My Requests" section shows request history with correct status badges

**Test limits:**
11. Verify that a user with 5 pending requests cannot send a 6th (should see error)
  </action>
  <verify>User types "approved" or describes issues to fix</verify>
  <done>Complete join request flow verified end-to-end by human tester</done>
</task>

</tasks>

<verification>
1. Complete end-to-end flow: browse → request → approve → member
2. Browse list accessible from both onboarding wizard and /teams page
3. Power user badge in sidebar (real-time)
4. Approve adds user to members array
5. Decline keeps request in Firestore with 'declined' status
6. Audit logs written for approve/decline
7. My Requests in Settings shows full history
8. Max 5 pending requests enforced
9. Declined users can re-request (no cooldown per CONTEXT.md)
10. All UI text internationalized in both languages
</verification>

<success_criteria>
- All 5 DISC requirements (DISC-01 through DISC-05) are met
- Browse list is reusable between wizard and standalone page (same component)
- Request Pending and Member badges are visually distinct
- Power user actions audited
- Declined/cancelled requests kept in Firestore (not deleted) per CONTEXT.md
- Multi-team support: user can browse even if already in a team
</success_criteria>

<output>
After completion, create `.planning/phases/12-team-discovery-join-requests/12-04-SUMMARY.md`
</output>
