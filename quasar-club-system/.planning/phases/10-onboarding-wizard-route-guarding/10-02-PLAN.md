---
phase: 10-onboarding-wizard-route-guarding
plan: 02
type: execute
wave: 2
depends_on:
  - 10-01
files_modified:
  - src/pages/OnboardingPage.vue
  - src/components/onboarding/OnboardingWizard.vue
  - src/composable/useOnboardingComposable.ts
  - src/i18n/cs-CZ/index.js
  - src/i18n/en-US/index.js
autonomous: false
requirements:
  - ONB-02
  - ONB-03
  - ONB-04

must_haves:
  truths:
    - "The wizard shows 3 steps: Welcome, Display Name, Team Choice"
    - "The welcome step shows app logo and 3-4 feature highlight icons/bullets"
    - "The display name step pre-fills from Firebase Auth displayName if it exists"
    - "Setting display name updates both Firebase Auth and Firestore user document"
    - "Step 3 shows two big cards: Create a Team and Browse Teams"
    - "Selecting Create a Team shows an inline create form (placeholder for Phase 11)"
    - "Selecting Browse Teams shows an inline team list (placeholder for Phase 12)"
    - "A back button returns from inline form/list to the card selection"
    - "After gaining team membership, user sees a success screen with Go to Dashboard button"
    - "Clicking Go to Dashboard navigates to /dashboard"
  artifacts:
    - path: "src/components/onboarding/OnboardingWizard.vue"
      provides: "QStepper-based 3-step onboarding wizard"
      min_lines: 100
    - path: "src/composable/useOnboardingComposable.ts"
      provides: "Onboarding logic: display name save, navigation, step management"
      min_lines: 30
    - path: "src/pages/OnboardingPage.vue"
      provides: "Page wrapper rendering OnboardingWizard"
      min_lines: 5
  key_links:
    - from: "src/components/onboarding/OnboardingWizard.vue"
      to: "src/composable/useOnboardingComposable.ts"
      via: "composable import for step logic and display name save"
      pattern: "useOnboardingComposable"
    - from: "src/composable/useOnboardingComposable.ts"
      to: "src/services/authFirebase.ts"
      via: "updateUserProfile for display name save"
      pattern: "updateUserProfile"
    - from: "src/composable/useOnboardingComposable.ts"
      to: "src/stores/authStore.ts"
      via: "reading current user for displayName pre-fill"
      pattern: "authStore"
---

<objective>
Build the 3-step onboarding wizard using QStepper with Welcome, Display Name, and Team Choice steps.

Purpose: Guide new teamless users through a focused onboarding flow that collects their display name and presents the two paths to gaining a team (create or browse/join). The actual team creation and browse/join logic are placeholders for Phases 11 and 12.

Output: Full onboarding wizard component, composable for logic, i18n translations, and updated OnboardingPage.
</objective>

<execution_context>
@C:/Users/Developer/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-onboarding-wizard-route-guarding/10-CONTEXT.md
@.planning/phases/10-onboarding-wizard-route-guarding/10-01-SUMMARY.md

Key existing files:
@src/services/authFirebase.ts — updateUserProfile function for display name
@src/stores/authStore.ts — user ref with displayName
@src/stores/teamStore.ts — teams array for post-membership detection
@src/composable/useAuthUseCases.ts — refreshCurrentUser for post-save refresh
@src/interfaces/interfaces.ts — IUser, ITeam interfaces
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create onboarding composable and wizard component with all 3 steps</name>
  <files>
    src/composable/useOnboardingComposable.ts
    src/components/onboarding/OnboardingWizard.vue
    src/pages/OnboardingPage.vue
    src/i18n/cs-CZ/index.js
    src/i18n/en-US/index.js
  </files>
  <action>
**1. Create `src/composable/useOnboardingComposable.ts`:**

Composable managing onboarding wizard state and actions. Follow existing composable patterns (camelCase, named export function).

State:
- `currentStep` — ref(1) for QStepper step tracking (1=Welcome, 2=DisplayName, 3=TeamChoice)
- `displayName` — ref('') for the name input
- `isLoading` — ref(false) for save operations
- `teamChoicePath` — ref<'create' | 'browse' | null>(null) for inline switching in step 3
- `showSuccess` — ref(false) for the "You're all set!" screen

Methods:
- `initDisplayName()` — reads `authStore.user?.displayName` and pre-fills `displayName` ref if it exists
- `saveDisplayName()` — calls `useAuthFirebase().updateUserProfile(uid, displayName)` to save to both Firebase Auth and Firestore. Wraps in try/catch, sets isLoading during operation. After save, calls `useAuthUseCases().refreshCurrentUser()` to sync the store. If displayName is empty, skip save silently (optional per decisions).
- `selectTeamPath(path: 'create' | 'browse')` — sets `teamChoicePath` to show inline content
- `backToCardSelection()` — sets `teamChoicePath` to null
- `goToDashboard()` — navigates to `RouteEnum.DASHBOARD.path` via `useRouter()`
- `nextStep()` — increments currentStep. When moving from step 2 to 3, calls saveDisplayName first.
- `prevStep()` — decrements currentStep

Return all state and methods.

**2. Create `src/components/onboarding/OnboardingWizard.vue`:**

A full-width centered wizard using Quasar QStepper. Per user decision: "Use Quasar QStepper with 3 steps."

Template structure:
```
<q-page class="flex flex-center" style="min-height: inherit">
  <!-- Success screen (shown after team gained) -->
  <div v-if="showSuccess" class="text-center">
    <q-icon name="check_circle" color="positive" size="80px" />
    <div class="text-h5 q-mt-md">{{ $t('onboarding.success.title') }}</div>
    <div class="text-body1 q-mt-sm text-grey-7">{{ $t('onboarding.success.subtitle') }}</div>
    <q-btn color="primary" :label="$t('onboarding.success.goToDashboard')" @click="goToDashboard" class="q-mt-lg" size="lg" />
  </div>

  <!-- Wizard stepper -->
  <q-stepper v-else v-model="currentStep" animated flat bordered style="max-width: 600px; width: 100%">

    <!-- Step 1: Welcome -->
    <q-step :name="1" :title="$t('onboarding.welcome.title')" icon="waving_hand" :done="currentStep > 1">
      <div class="text-center q-py-md">
        <q-icon name="sports_soccer" size="64px" color="primary" class="q-mb-md" />
        <div class="text-h5 q-mb-md">{{ $t('onboarding.welcome.heading') }}</div>
        <div class="text-body1 text-grey-7 q-mb-lg">{{ $t('onboarding.welcome.description') }}</div>

        <!-- Feature highlights: 3-4 icons with labels -->
        <div class="row justify-center q-gutter-md q-mb-md">
          <div class="col-auto text-center" style="width: 120px">
            <q-icon name="how_to_vote" size="36px" color="primary" />
            <div class="text-caption q-mt-xs">{{ $t('onboarding.welcome.feature1') }}</div>
          </div>
          <div class="col-auto text-center" style="width: 120px">
            <q-icon name="bar_chart" size="36px" color="primary" />
            <div class="text-caption q-mt-xs">{{ $t('onboarding.welcome.feature2') }}</div>
          </div>
          <div class="col-auto text-center" style="width: 120px">
            <q-icon name="groups" size="36px" color="primary" />
            <div class="text-caption q-mt-xs">{{ $t('onboarding.welcome.feature3') }}</div>
          </div>
        </div>
      </div>
      <q-stepper-navigation>
        <q-btn color="primary" :label="$t('onboarding.next')" @click="nextStep" />
      </q-stepper-navigation>
    </q-step>

    <!-- Step 2: Display Name -->
    <q-step :name="2" :title="$t('onboarding.displayName.title')" icon="person" :done="currentStep > 2">
      <div class="q-py-md">
        <div class="text-body1 q-mb-md">{{ $t('onboarding.displayName.description') }}</div>
        <q-input v-model="displayName" :label="$t('onboarding.displayName.label')" :hint="$t('onboarding.displayName.hint')" outlined class="q-mb-md" />
      </div>
      <q-stepper-navigation>
        <q-btn color="primary" :label="$t('onboarding.next')" @click="nextStep" :loading="isLoading" />
        <q-btn flat :label="$t('onboarding.back')" @click="prevStep" class="q-ml-sm" />
      </q-stepper-navigation>
    </q-step>

    <!-- Step 3: Team Choice -->
    <q-step :name="3" :title="$t('onboarding.teamChoice.title')" icon="group_add">
      <div class="q-py-md">
        <!-- Card selection (shown when no path selected) -->
        <div v-if="!teamChoicePath" class="row q-gutter-md justify-center">
          <q-card clickable @click="selectTeamPath('create')" class="col-12 col-sm-5 cursor-pointer" bordered>
            <q-card-section class="text-center q-pa-lg">
              <q-icon name="add_circle" size="48px" color="primary" />
              <div class="text-h6 q-mt-sm">{{ $t('onboarding.teamChoice.createTitle') }}</div>
              <div class="text-body2 text-grey-7 q-mt-xs">{{ $t('onboarding.teamChoice.createDescription') }}</div>
            </q-card-section>
          </q-card>
          <q-card clickable @click="selectTeamPath('browse')" class="col-12 col-sm-5 cursor-pointer" bordered>
            <q-card-section class="text-center q-pa-lg">
              <q-icon name="search" size="48px" color="primary" />
              <div class="text-h6 q-mt-sm">{{ $t('onboarding.teamChoice.browseTitle') }}</div>
              <div class="text-body2 text-grey-7 q-mt-xs">{{ $t('onboarding.teamChoice.browseDescription') }}</div>
            </q-card-section>
          </q-card>
        </div>

        <!-- Inline Create Team form (placeholder for Phase 11) -->
        <div v-else-if="teamChoicePath === 'create'">
          <q-btn flat icon="arrow_back" :label="$t('onboarding.back')" @click="backToCardSelection" class="q-mb-md" />
          <q-banner class="bg-info text-white rounded-borders">
            <template v-slot:avatar><q-icon name="info" /></template>
            {{ $t('onboarding.teamChoice.createPlaceholder') }}
          </q-banner>
        </div>

        <!-- Inline Browse Teams list (placeholder for Phase 12) -->
        <div v-else-if="teamChoicePath === 'browse'">
          <q-btn flat icon="arrow_back" :label="$t('onboarding.back')" @click="backToCardSelection" class="q-mb-md" />
          <q-banner class="bg-info text-white rounded-borders">
            <template v-slot:avatar><q-icon name="info" /></template>
            {{ $t('onboarding.teamChoice.browsePlaceholder') }}
          </q-banner>
        </div>
      </div>
      <q-stepper-navigation>
        <q-btn flat :label="$t('onboarding.back')" @click="prevStep" />
      </q-stepper-navigation>
    </q-step>

  </q-stepper>
</q-page>
```

Script setup:
- Import and use `useOnboardingComposable`
- Destructure all needed state and methods
- Call `initDisplayName()` on setup (no need for onMounted since composable runs synchronously)

Add a watcher on `teamStore.teams` — when `teams.length > 0` (user just gained a team, either via create or join), set `showSuccess = true`. This connects to Phases 11/12 output.

**3. Update `src/pages/OnboardingPage.vue`:**

Replace the placeholder from Plan 01 with the actual wizard component:
```vue
<template>
  <OnboardingWizard />
</template>

<script setup>
import OnboardingWizard from '@/components/onboarding/OnboardingWizard.vue'
</script>
```

**4. Add i18n translations:**

Add an `onboarding` key to BOTH Czech (`cs-CZ`) and English (`en-US`) translation files.

English translations:
```json
"onboarding": {
  "next": "Continue",
  "back": "Back",
  "welcome": {
    "title": "Welcome",
    "heading": "Welcome to Club System",
    "description": "Your team management platform for surveys, reports, and collaboration.",
    "feature1": "Surveys & Attendance",
    "feature2": "Reports & Statistics",
    "feature3": "Team Management"
  },
  "displayName": {
    "title": "Your Name",
    "description": "Set a display name so your teammates can recognize you.",
    "label": "Display name",
    "hint": "Your teammates will see this name"
  },
  "teamChoice": {
    "title": "Join a Team",
    "createTitle": "Create a Team",
    "createDescription": "Start a new team and invite others to join.",
    "browseTitle": "Browse Teams",
    "browseDescription": "Find and join an existing team.",
    "createPlaceholder": "Team creation will be available soon.",
    "browsePlaceholder": "Team browsing will be available soon."
  },
  "success": {
    "title": "You're all set!",
    "subtitle": "Your team is ready. Let's get started.",
    "goToDashboard": "Go to Dashboard"
  }
}
```

Czech translations:
```json
"onboarding": {
  "next": "Pokračovat",
  "back": "Zpět",
  "welcome": {
    "title": "Vítejte",
    "heading": "Vítejte v Club System",
    "description": "Vaše platforma pro správu týmu, ankety, reporty a spolupráci.",
    "feature1": "Ankety a docházka",
    "feature2": "Reporty a statistiky",
    "feature3": "Správa týmu"
  },
  "displayName": {
    "title": "Vaše jméno",
    "description": "Nastavte si zobrazované jméno, aby vás spoluhráči poznali.",
    "label": "Zobrazované jméno",
    "hint": "Toto jméno uvidí vaši spoluhráči"
  },
  "teamChoice": {
    "title": "Připojte se k týmu",
    "createTitle": "Vytvořit tým",
    "createDescription": "Založte nový tým a pozvěte ostatní.",
    "browseTitle": "Procházet týmy",
    "browseDescription": "Najděte a připojte se k existujícímu týmu.",
    "createPlaceholder": "Vytváření týmů bude brzy dostupné.",
    "browsePlaceholder": "Procházení týmů bude brzy dostupné."
  },
  "success": {
    "title": "Vše je připraveno!",
    "subtitle": "Váš tým je připraven. Pojďme na to.",
    "goToDashboard": "Přejít na nástěnku"
  }
}
```

Find the existing translation structure in both i18n files and add the `onboarding` key at the appropriate level. The i18n files may use JS objects with `export default` — match the existing pattern.
  </action>
  <verify>
    - `useOnboardingComposable.ts` exists with all state and methods
    - `OnboardingWizard.vue` exists with QStepper, 3 steps, and inline card switching in step 3
    - `OnboardingPage.vue` renders OnboardingWizard component
    - i18n files contain all onboarding translation keys in both CS and EN
    - App compiles without errors
    - Navigating to /onboarding shows the 3-step wizard
    - Step 2 pre-fills display name if user has one set
    - Step 3 shows two cards, clicking one reveals inline content with back button
  </verify>
  <done>
    Onboarding wizard renders 3 steps (Welcome, Display Name, Team Choice). Display name pre-fills from Firebase Auth and saves to both Auth and Firestore. Step 3 shows two-card fork with inline switching. Placeholder content for create/browse is ready for Phases 11/12. Success screen with dashboard redirect is wired to team store watcher.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Verify onboarding wizard flow</name>
  <files>src/components/onboarding/OnboardingWizard.vue</files>
  <action>
    Human verification of the complete onboarding wizard flow.
    What was built: Complete onboarding wizard with 3-step QStepper, route guarding for teamless users, clean layout, display name save, and two-card team choice with inline switching.
    How to verify:
    1. Run `quasar dev` in the project directory
    2. Log in as a user who has NO team (create a new user via /register if needed)
    3. Verify: You are automatically redirected to /onboarding
    4. Verify: The page shows a clean layout with no sidebar, no drawer — only a minimal header with app title and logout
    5. Verify: Step 1 (Welcome) shows an icon, welcome text, and 3 feature highlight icons
    6. Click "Continue" to go to Step 2
    7. Verify: Display name field is pre-filled if the user had a displayName in Firebase Auth
    8. Type a display name and click "Continue"
    9. Verify: Step 3 shows two big cards side by side: "Create a Team" and "Browse Teams"
    10. Click "Create a Team" — verify inline placeholder appears with a back button
    11. Click back — verify cards reappear
    12. Click "Browse Teams" — verify inline placeholder appears with a back button
    13. Log out from the onboarding page — verify redirect to login
    14. Log in as a user who HAS a team
    15. Verify: User goes directly to /dashboard (no onboarding shown)
    16. Manually navigate to /onboarding — verify redirect back to /dashboard
  </action>
  <verify>User confirms all 16 verification steps pass</verify>
  <done>Onboarding wizard flow verified end-to-end by human tester</done>
</task>

</tasks>

<verification>
1. 3-step QStepper renders: Welcome → Display Name → Team Choice
2. Welcome step shows app icon and 3 feature highlights
3. Display name pre-fills from Firebase Auth displayName
4. Saving display name updates both Firebase Auth and Firestore user doc
5. Step 3 shows two equal-weight cards for Create and Browse paths
6. Clicking a card reveals inline content; back button returns to card selection
7. Teamless user watcher: when teams array becomes non-empty, success screen shows
8. Success screen has "Go to Dashboard" button that navigates to /dashboard
9. All text uses i18n keys with both Czech and English translations
10. Route guard from Plan 01 correctly redirects teamless users and blocks team-having users from onboarding
</verification>

<success_criteria>
- Onboarding wizard is fully interactive with all 3 steps
- Display name is saveable from step 2
- Team choice step shows inline create/browse placeholders with back navigation
- i18n translations exist in both languages
- Human verification confirms the full flow works end-to-end
</success_criteria>

<output>
After completion, create `.planning/phases/10-onboarding-wizard-route-guarding/10-02-SUMMARY.md`
</output>
