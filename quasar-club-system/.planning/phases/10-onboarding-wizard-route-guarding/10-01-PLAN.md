---
phase: 10-onboarding-wizard-route-guarding
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/enums/routesEnum.ts
  - src/router/routes.js
  - src/router/index.js
  - src/layouts/OnboardingLayout.vue
  - src/pages/OnboardingPage.vue
autonomous: true
requirements:
  - ROUTE-01
  - ROUTE-02
  - ONB-01

must_haves:
  truths:
    - "A teamless authenticated user navigating to any protected page is redirected to /onboarding"
    - "A user with a team who visits /onboarding is redirected to /dashboard"
    - "Unauthenticated users are still redirected to /login as before"
    - "The onboarding page renders in a clean full-page layout with no sidebar or navigation"
  artifacts:
    - path: "src/enums/routesEnum.ts"
      provides: "ONBOARDING route definition"
      contains: "ONBOARDING"
    - path: "src/router/index.js"
      provides: "Route guard with teamless redirect logic"
      contains: "onboarding"
    - path: "src/router/routes.js"
      provides: "Onboarding route entry under OnboardingLayout"
      contains: "OnboardingPage"
    - path: "src/layouts/OnboardingLayout.vue"
      provides: "Clean full-page layout for onboarding (no sidebar, no nav)"
      min_lines: 5
    - path: "src/pages/OnboardingPage.vue"
      provides: "Placeholder onboarding page that renders in the layout"
      min_lines: 5
  key_links:
    - from: "src/router/index.js"
      to: "src/stores/teamStore.ts"
      via: "teamStore.teams.length check in beforeEach guard"
      pattern: "teamStore\\.teams"
    - from: "src/router/index.js"
      to: "src/enums/routesEnum.ts"
      via: "RouteEnum.ONBOARDING reference"
      pattern: "RouteEnum\\.ONBOARDING"
    - from: "src/router/routes.js"
      to: "src/layouts/OnboardingLayout.vue"
      via: "route layout component import"
      pattern: "OnboardingLayout"
---

<objective>
Set up route guarding for teamless users and create the onboarding route with a dedicated clean layout.

Purpose: Intercept users who have no team and redirect them to the onboarding wizard, while ensuring users with teams skip onboarding entirely. This is the foundation that the wizard component (Plan 02) builds on.

Output: Route guard logic, onboarding route, OnboardingLayout, and placeholder OnboardingPage.
</objective>

<execution_context>
@C:/Users/Developer/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-onboarding-wizard-route-guarding/10-CONTEXT.md

Key existing files to reference:
@src/router/index.js — current auth guard logic (modify)
@src/router/routes.js — current route definitions (modify)
@src/enums/routesEnum.ts — route enum (modify)
@src/stores/authStore.ts — isAuthReady, isTeamReady flags
@src/stores/teamStore.ts — teams array (teams.length === 0 means no team)
@src/layouts/AuthLayout.vue — reference for minimal layout pattern
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add onboarding route enum and create OnboardingLayout</name>
  <files>
    src/enums/routesEnum.ts
    src/layouts/OnboardingLayout.vue
  </files>
  <action>
1. In `src/enums/routesEnum.ts`, add a new entry to RouteEnum:
   ```
   ONBOARDING: { path: '/onboarding', name: 'onboarding' },
   ```
   Place it after the REGISTER entry to keep auth-related routes grouped.

2. Create `src/layouts/OnboardingLayout.vue` — a clean full-page layout with no sidebar, no drawer, no navigation header. Per user decision: "Full-page layout — no sidebar, no navigation visible during onboarding. Completely clean experience." The layout should include only a minimal top bar with the app logo/title and a logout button (per decision: "except possibly a minimal bar with logo + logout"). Use Quasar's `q-layout` with a simple `q-header` containing only app title and a logout `q-btn`. The `q-page-container` renders the `<router-view />`. No drawer. Style: clean, centered feel.

   Reference `src/layouts/AuthLayout.vue` for the minimal pattern, but add the slim header with logo + logout.

   For the logout button, import and use `useAuthUseCases` to call `signOut()`. Use `useI18n` for the app title translation key `app.title`.
  </action>
  <verify>
    - `routesEnum.ts` contains `ONBOARDING` entry with path `/onboarding`
    - `OnboardingLayout.vue` exists, has `q-layout` with `q-header` (logo + logout), `q-page-container`, `router-view`, and NO drawer/sidebar
    - App compiles: run `npx quasar build` or dev server shows no errors
  </verify>
  <done>
    ONBOARDING route enum exists. OnboardingLayout renders a clean full-page layout with only a minimal header (app title + logout button) and a router-view.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add onboarding route definition and update route guard for teamless redirect</name>
  <files>
    src/router/routes.js
    src/router/index.js
    src/pages/OnboardingPage.vue
  </files>
  <action>
1. Create `src/pages/OnboardingPage.vue` as a minimal placeholder page:
   ```vue
   <template>
     <q-page class="flex flex-center">
       <div class="text-h5">Onboarding Wizard</div>
     </q-page>
   </template>
   ```
   This will be replaced by the full wizard in Plan 02.

2. In `src/router/routes.js`, add a NEW route group between the AuthLayout group and MainLayout group:
   ```javascript
   {
     path: "/",
     component: () => import("layouts/OnboardingLayout.vue"),
     children: [
       { path: RouteEnum.ONBOARDING.path, name: RouteEnum.ONBOARDING.name, component: () => import("pages/OnboardingPage.vue") },
     ]
   },
   ```

3. In `src/router/index.js`, update the `beforeEach` guard to handle teamless users. The guard must:
   - Import `useTeamStore` from `@/stores/teamStore`
   - After existing auth ready wait, ALSO wait for `authStore.isTeamReady` before checking team state. Use the same watch pattern already used for `isAuthReady`:
     ```javascript
     if (authStore.user?.uid && !authStore.isTeamReady) {
       await new Promise((resolve) => {
         const stop = watch(
           () => authStore.isTeamReady,
           (ready) => {
             if (ready) { stop(); resolve() }
           }
         )
       })
     }
     ```
   - Define `const onboardingPath = RouteEnum.ONBOARDING.path`
   - Add onboardingPath to the logic. The full guard flow should be:
     a. Wait for isAuthReady (existing)
     b. If authenticated, wait for isTeamReady (new)
     c. `publicPaths` stays as-is: `[RouteEnum.LOGIN.path, RouteEnum.REGISTER.path]`
     d. Root redirect: existing behavior
     e. If NOT authenticated and NOT public → redirect to login (existing)
     f. If authenticated and on public path → redirect to dashboard (existing)
     g. **NEW: If authenticated, isTeamReady, teams is empty, and NOT already going to onboarding → redirect to onboarding**
        ```javascript
        const teamStore = useTeamStore()
        const hasNoTeam = authStore.user?.uid && authStore.isTeamReady && teamStore.teams.length === 0
        ```
        Check: `hasNoTeam && to.path !== onboardingPath` → `next(onboardingPath)`
     h. **NEW: If authenticated, has a team, and going to onboarding → redirect to dashboard**
        Check: `authStore.user?.uid && teamStore.teams.length > 0 && to.path === onboardingPath` → `next(RouteEnum.DASHBOARD.path)`
     i. Admin check (existing)
     j. Otherwise `next()` (existing)

   IMPORTANT: The order of checks matters. Place the teamless/onboarding checks AFTER the auth checks but BEFORE the final `next()`. Keep the root `/` redirect, public path redirect, and admin check in their existing positions. The teamless check goes right before the final `else { next() }`.
  </action>
  <verify>
    - `OnboardingPage.vue` exists and renders placeholder text
    - `routes.js` has the onboarding route under OnboardingLayout
    - `index.js` imports useTeamStore, waits for isTeamReady, and has teamless redirect logic
    - App compiles without errors
    - Manual test: A user with no team should be redirected to /onboarding from /dashboard
    - Manual test: A user with a team visiting /onboarding should be redirected to /dashboard
  </verify>
  <done>
    Route guard redirects teamless authenticated users to /onboarding. Users with teams who visit /onboarding are redirected to /dashboard. The onboarding page renders inside OnboardingLayout (clean, no sidebar).
  </done>
</task>

</tasks>

<verification>
1. A newly registered user (no team) navigating to /dashboard is redirected to /onboarding
2. A newly registered user navigating to /survey, /reports, etc. is redirected to /onboarding
3. A user with a team navigating to /onboarding is redirected to /dashboard
4. A user with a team navigating normally sees the app as before (no regression)
5. Unauthenticated users are still redirected to /login
6. The onboarding page renders in a clean layout (no sidebar, no nav drawer, minimal header with logout)
7. Logging out from onboarding page works and redirects to login
</verification>

<success_criteria>
- Route guard correctly distinguishes between teamless and team-having users
- Onboarding route exists at /onboarding under OnboardingLayout
- No regression to existing authenticated routing behavior
- App compiles and runs without errors
</success_criteria>

<output>
After completion, create `.planning/phases/10-onboarding-wizard-route-guarding/10-01-SUMMARY.md`
</output>
