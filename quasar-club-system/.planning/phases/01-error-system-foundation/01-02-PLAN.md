---
phase: 01-error-system-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/services/notificationService.ts
  - src/boot/errorHandler.ts
  - quasar.config.js
autonomous: true

must_haves:
  truths:
    - "User sees error notifications with retry button for recoverable errors"
    - "Application catches unhandled errors and displays user-friendly messages"
    - "Retry button executes failed operation again"
  artifacts:
    - path: "src/services/notificationService.ts"
      provides: "Quasar Notify wrapper with retry support"
      exports: ["notifyError", "notifySuccess"]
      min_lines: 40
    - path: "src/boot/errorHandler.ts"
      provides: "Vue global error handler"
      exports: ["default"]
      min_lines: 20
    - path: "quasar.config.js"
      provides: "Boot file registration"
      contains: "boot: ['i18n', 'errorHandler']"
  key_links:
    - from: "src/boot/errorHandler.ts"
      to: "src/services/notificationService.ts"
      via: "import notifyError"
      pattern: "import.*notifyError.*from.*notificationService"
    - from: "src/boot/errorHandler.ts"
      to: "src/errors"
      via: "import AppError"
      pattern: "import.*AppError.*from.*errors"
---

<objective>
Create notification service wrapping Quasar Notify with retry support and set up global Vue error handler to catch unhandled errors.

Purpose: Provide consistent error UI with retry mechanisms and ensure no errors crash the application
Output: Notification service with retry actions and Vue errorHandler boot file
</objective>

<execution_context>
@C:/Users/Developer/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:/Users/Developer/Documents/projekty/diplomova-prace/quasar-club-system/.planning/PROJECT.md
@C:/Users/Developer/Documents/projekty/diplomova-prace/quasar-club-system/.planning/ROADMAP.md
@C:/Users/Developer/Documents/projekty/diplomova-prace/quasar-club-system/.planning/STATE.md
@C:/Users/Developer/Documents/projekty/diplomova-prace/quasar-club-system/.planning/phases/01-error-system-foundation/01-RESEARCH.md
@C:/Users/Developer/Documents/projekty/diplomova-prace/quasar-club-system/.planning/codebase/CONVENTIONS.md
@C:/Users/Developer/Documents/projekty/diplomova-prace/quasar-club-system/.planning/codebase/ARCHITECTURE.md
@C:/Users/Developer/Documents/projekty/diplomova-prace/quasar-club-system/quasar.config.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create notification service with retry support</name>
  <files>
    src/services/notificationService.ts
  </files>
  <action>
Create Quasar Notify wrapper service following research Pattern 4:

**notificationService.ts:**
- Import Notify from 'quasar'
- Import useI18n from 'vue-i18n'

- Define NotifyErrorOptions interface:
  ```typescript
  interface NotifyErrorOptions {
    context?: Record<string, unknown>
    retry?: boolean
    onRetry?: () => Promise<void>
  }
  ```

- Export notifyError function:
  - Parameters: messageKey (string), options (NotifyErrorOptions = {})
  - Get i18n t function using useI18n()
  - Create Quasar notify config:
    - type: 'negative'
    - message: t(messageKey, options.context) for i18n interpolation
    - position: 'top'
    - timeout: options.retry ? 0 : 5000 (persistent if retry available, else auto-dismiss)
  - If options.retry && options.onRetry:
    - Add actions array with retry button:
      - label: t('common.retry')
      - color: 'white'
      - handler: async function that calls options.onRetry
        - On success: show success notification via Notify.create with type 'positive', message t('common.retrySuccess'), timeout 2000
        - On error: recursively call notifyError again with same params (max 3 retries - add retryCount to options)
    - Add dismiss button: { label: t('common.dismiss'), color: 'white' }
  - Call Notify.create(notifyConfig)

- Export notifySuccess function:
  - Parameters: messageKey (string), context (Record<string, unknown> optional)
  - Get t function
  - Call Notify.create with type 'positive', message t(messageKey, context), position 'top', timeout 3000

Follow conventions: camelCase for file, named exports, no semicolons.

IMPORTANT: Do NOT add retry/retrySuccess/dismiss to i18n files - these already exist in common section per codebase analysis.
  </action>
  <verify>
    TypeScript compilation succeeds: `npm run build`
    Test in browser console: Import and call notifyError with test message key
    Test retry flow: Call notifyError with retry: true and onRetry callback, verify retry button appears
  </verify>
  <done>
    notificationService.ts exports notifyError and notifySuccess
    notifyError supports retry actions with onRetry callback
    Persistent notifications when retry is true (timeout: 0)
    Auto-dismissing notifications when no retry (timeout: 5000)
    Success notification on successful retry
    No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Set up Vue global error handler</name>
  <files>
    src/boot/errorHandler.ts
    quasar.config.js
  </files>
  <action>
Create Vue global error handler boot file following research Pattern 2:

**errorHandler.ts:**
- Import { boot } from 'quasar/wrappers'
- Import { notifyError } from 'src/services/notificationService'
- Import { AppError, AuthError, FirestoreError } from 'src/errors'

- Export default boot function:
  - Destructure { app } from parameter
  - Set app.config.errorHandler = (err: unknown, instance, info) => {
    - Log to console: console.error('Global error handler:', err, info)
    - Check error type using instanceof:
      - If AuthError or FirestoreError:
        - Call notifyError(err.message, { context: err.context, retry: true })
        - Note: Retry callback NOT provided here - global handler shows error without retry action (retry only makes sense when called from specific operation context)
      - Else if AppError (ValidationError, ListenerError):
        - Call notifyError(err.message, { context: err.context, retry: false })
      - Else (unknown error):
        - Call notifyError('errors.unexpected', { retry: false })
  - }

**Update quasar.config.js:**
- Find boot array in module.exports.boot
- Existing boot files: ['i18n'] per research
- Add 'errorHandler' to array: boot: ['i18n', 'errorHandler']
- Place errorHandler AFTER i18n (i18n must load first for translations)

Follow conventions: camelCase for file, named exports using export default boot wrapper, no semicolons.
  </action>
  <verify>
    Quasar dev server starts without errors: `quasar dev`
    Check boot order in browser console: errorHandler should initialize after i18n
    Test error catching: In browser console, throw new Error('test') inside a Vue component lifecycle hook
    Verify: Error notification appears with message from errors.unexpected i18n key
  </verify>
  <done>
    errorHandler.ts boot file exists with global error handler
    app.config.errorHandler catches all Vue lifecycle errors
    Typed errors show localized messages
    Unknown errors show generic unexpected error message
    Boot file registered in quasar.config.js after i18n
    No console errors on app startup
  </done>
</task>

</tasks>

<verification>
Start development server: `quasar dev`
Test error notification in browser console:
  - Import notifyError: `import { notifyError } from 'src/services/notificationService'`
  - Call: `notifyError('errors.auth.wrongPassword')`
  - Verify: Red notification appears at top with Czech message
Test retry flow:
  - Call: `notifyError('errors.firestore.unavailable', { retry: true, onRetry: async () => console.log('retried') })`
  - Verify: Notification is persistent (no auto-dismiss)
  - Verify: Retry and Dismiss buttons appear
  - Click Retry: Console shows 'retried' and success notification appears
Test global error handler:
  - In Vue component, throw error in lifecycle hook
  - Verify: Error caught and notification shown
</verification>

<success_criteria>
- User sees error notifications with Czech/English messages
- Retry button appears for errors with onRetry callback
- Retry button executes callback and shows success on completion
- Global error handler catches unhandled Vue errors
- Application continues running after errors (no white screen crashes)
- Boot file loads after i18n for proper translation support
</success_criteria>

<output>
After completion, create `.planning/phases/01-error-system-foundation/01-02-SUMMARY.md`
</output>
