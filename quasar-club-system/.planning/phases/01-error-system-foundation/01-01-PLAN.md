---
phase: 01-error-system-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/errors/AppError.ts
  - src/errors/AuthError.ts
  - src/errors/FirestoreError.ts
  - src/errors/ValidationError.ts
  - src/errors/ListenerError.ts
  - src/errors/errorMapper.ts
  - src/errors/index.ts
  - src/i18n/cs-CZ/errors.js
  - src/i18n/en-US/errors.js
  - src/i18n/cs-CZ/index.js
  - src/i18n/en-US/index.js
autonomous: true

must_haves:
  truths:
    - "Developer sees typed error classes in IDE autocomplete when catching errors"
    - "Czech and English error messages exist for common Firebase failures"
    - "Error mapper converts Firebase codes to i18n keys"
  artifacts:
    - path: "src/errors/AppError.ts"
      provides: "Base error class with prototype chain fix"
      min_lines: 15
    - path: "src/errors/AuthError.ts"
      provides: "Firebase Auth error wrapper"
      exports: ["AuthError"]
    - path: "src/errors/FirestoreError.ts"
      provides: "Firestore error wrapper with operation type"
      exports: ["FirestoreError"]
    - path: "src/errors/errorMapper.ts"
      provides: "Firebase error code to i18n key mapping"
      exports: ["mapFirebaseAuthError", "mapFirestoreError"]
    - path: "src/i18n/cs-CZ/errors.js"
      provides: "Czech error messages"
      contains: "auth:"
    - path: "src/i18n/en-US/errors.js"
      provides: "English error messages"
      contains: "auth:"
  key_links:
    - from: "src/errors/errorMapper.ts"
      to: "src/errors/AuthError.ts"
      via: "import and instantiate"
      pattern: "new AuthError"
    - from: "src/i18n/cs-CZ/index.js"
      to: "src/i18n/cs-CZ/errors.js"
      via: "export default merge"
      pattern: "errors:"
---

<objective>
Create typed error hierarchy and Firebase error mapping to replace `any`-typed catches with type-safe error handling.

Purpose: Enable programmatic error distinction (auth vs database vs validation) and map Firebase error codes to user-friendly i18n messages
Output: Error classes, mapper service, and Czech/English error messages for all common Firebase failures
</objective>

<execution_context>
@C:/Users/Developer/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Developer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@C:/Users/Developer/Documents/projekty/diplomova-prace/quasar-club-system/.planning/PROJECT.md
@C:/Users/Developer/Documents/projekty/diplomova-prace/quasar-club-system/.planning/ROADMAP.md
@C:/Users/Developer/Documents/projekty/diplomova-prace/quasar-club-system/.planning/STATE.md
@C:/Users/Developer/Documents/projekty/diplomova-prace/quasar-club-system/.planning/phases/01-error-system-foundation/01-RESEARCH.md
@C:/Users/Developer/Documents/projekty/diplomova-prace/quasar-club-system/.planning/codebase/CONVENTIONS.md
@C:/Users/Developer/Documents/projekty/diplomova-prace/quasar-club-system/.planning/codebase/ARCHITECTURE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create typed error class hierarchy</name>
  <files>
    src/errors/AppError.ts
    src/errors/AuthError.ts
    src/errors/FirestoreError.ts
    src/errors/ValidationError.ts
    src/errors/ListenerError.ts
    src/errors/index.ts
  </files>
  <action>
Create TypeScript error class hierarchy following research Pattern 1:

**Base class (AppError.ts):**
- Extend Error with manual prototype chain fix using `Object.setPrototypeOf(this, new.target.prototype)` for ES5/ES6 instanceof compatibility
- Add timestamp field (Date)
- Add optional context field (Record<string, unknown>)
- Set name to constructor.name

**AuthError class:**
- Extend AppError
- Add code field (string) for Firebase auth error codes
- Constructor accepts: code, message, optional context

**FirestoreError class:**
- Extend AppError
- Add code field (string)
- Add operation field ('read' | 'write' | 'delete')
- Constructor accepts: code, operation, message, optional context

**ValidationError class:**
- Extend AppError
- Add field property (string)
- Constructor accepts: field, message
- Auto-populate context with { field }

**ListenerError class:**
- Extend AppError
- Add listenerType property (string) for debugging which listener failed
- Constructor accepts: listenerType, message, optional context

**Barrel export (index.ts):**
- Export all error classes via named exports

Follow conventions: PascalCase for classes, named exports only, no semicolons per Prettier config.
</action>
  <verify>
    TypeScript compilation succeeds: `npm run build`
    Test instanceof check: Create small test file that instantiates AuthError and verifies `error instanceof AuthError`, `error instanceof AppError`, `error instanceof Error` all return true
  </verify>
  <done>
    All 5 error classes exist with proper TypeScript types
    Prototype chain fix applied to base AppError class
    Barrel index exports all classes
    No TypeScript errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Firebase error mapper and i18n messages</name>
  <files>
    src/errors/errorMapper.ts
    src/i18n/cs-CZ/errors.js
    src/i18n/en-US/errors.js
    src/i18n/cs-CZ/index.js
    src/i18n/en-US/index.js
  </files>
  <action>
Create Firebase error code mapping service and localized messages following research Pattern 3:

**errorMapper.ts:**
- Import FirebaseError from 'firebase/app'
- Import AuthError, FirestoreError from './index'
- Create AUTH_ERROR_MAP constant mapping Firebase codes to i18n keys:
  - 'auth/wrong-password' → 'errors.auth.wrongPassword'
  - 'auth/invalid-credential' → 'errors.auth.invalidCredential'
  - 'auth/user-not-found' → 'errors.auth.userNotFound'
  - 'auth/email-already-in-use' → 'errors.auth.emailInUse'
  - 'auth/weak-password' → 'errors.auth.weakPassword'
  - 'auth/network-request-failed' → 'errors.auth.networkFailed'
  - 'auth/too-many-requests' → 'errors.auth.tooManyRequests'
  - 'auth/requires-recent-login' → 'errors.auth.requiresRecentLogin'
- Create FIRESTORE_ERROR_MAP for codes:
  - 'permission-denied' → 'errors.firestore.permissionDenied'
  - 'unavailable' → 'errors.firestore.unavailable'
  - 'not-found' → 'errors.firestore.notFound'
  - 'already-exists' → 'errors.firestore.alreadyExists'
  - 'failed-precondition' → 'errors.firestore.failedPrecondition'
- Export mapFirebaseAuthError(error: unknown): AuthError
  - Cast to FirebaseError, extract code
  - Lookup i18n key from AUTH_ERROR_MAP, fallback to 'errors.auth.unknown'
  - Return new AuthError(code, i18nKey, { originalMessage })
- Export mapFirestoreError(error: unknown, operation: 'read' | 'write' | 'delete'): FirestoreError
  - Cast to FirebaseError, strip 'firestore/' prefix from code if present
  - Lookup i18n key, fallback to 'errors.firestore.unknown'
  - Return new FirestoreError(code, operation, i18nKey, { originalMessage })

**Czech messages (cs-CZ/errors.js):**
```javascript
export default {
  auth: {
    wrongPassword: 'Nesprávné heslo. Zkuste to prosím znovu.',
    invalidCredential: 'Neplatné přihlašovací údaje.',
    userNotFound: 'Uživatel nenalezen.',
    emailInUse: 'Email je již registrován.',
    weakPassword: 'Heslo je příliš slabé. Musí mít alespoň 6 znaků.',
    networkFailed: 'Chyba sítě. Zkontrolujte připojení k internetu.',
    tooManyRequests: 'Příliš mnoho pokusů. Počkejte prosím chvíli.',
    requiresRecentLogin: 'Prosím přihlaste se znovu pro dokončení této akce.',
    unknown: 'Neznámá chyba autentizace.'
  },
  firestore: {
    permissionDenied: 'Nemáte oprávnění k této operaci.',
    unavailable: 'Databáze je dočasně nedostupná.',
    notFound: 'Data nebyla nalezena.',
    alreadyExists: 'Data již existují.',
    failedPrecondition: 'Operace nelze dokončit.',
    unknown: 'Neznámá databázová chyba.'
  },
  validation: {
    required: 'Toto pole je povinné.',
    invalidFormat: 'Neplatný formát.'
  },
  listener: {
    failed: 'Živé aktualizace selhaly.'
  },
  unexpected: 'Neočekávaná chyba. Zkuste to prosím znovu.'
}
```

**English messages (en-US/errors.js):**
```javascript
export default {
  auth: {
    wrongPassword: 'Incorrect password. Please try again.',
    invalidCredential: 'Invalid credentials.',
    userNotFound: 'User not found.',
    emailInUse: 'Email is already registered.',
    weakPassword: 'Password is too weak. Must be at least 6 characters.',
    networkFailed: 'Network error. Check your internet connection.',
    tooManyRequests: 'Too many attempts. Please wait a moment.',
    requiresRecentLogin: 'Please sign in again to complete this action.',
    unknown: 'Unknown authentication error.'
  },
  firestore: {
    permissionDenied: 'You do not have permission for this operation.',
    unavailable: 'Database is temporarily unavailable.',
    notFound: 'Data not found.',
    alreadyExists: 'Data already exists.',
    failedPrecondition: 'Operation cannot be completed.',
    unknown: 'Unknown database error.'
  },
  validation: {
    required: 'This field is required.',
    invalidFormat: 'Invalid format.'
  },
  listener: {
    failed: 'Live updates failed.'
  },
  unexpected: 'Unexpected error. Please try again.'
}
```

**Update locale index files:**
- Import errors from './errors.js'
- Add `errors` to default export object

Follow conventions: camelCase for file, named exports, single quotes, no semicolons.
  </action>
  <verify>
    i18n messages load without errors: Start dev server `quasar dev` and check console
    Verify Czech message: Open browser console and run `$t('errors.auth.wrongPassword')` (should return Czech text)
    Verify English: Change language in app, check `$t('errors.auth.wrongPassword')` returns English
    TypeScript types: Import mapFirebaseAuthError in a .ts file and verify type signature
  </verify>
  <done>
    errorMapper exports mapFirebaseAuthError and mapFirestoreError functions
    All 8 auth error codes mapped to i18n keys
    All 5 Firestore error codes mapped to i18n keys
    Czech and English messages for all mapped codes
    Messages integrated into existing i18n structure
  </done>
</task>

</tasks>

<verification>
Run TypeScript compiler: `npm run build` should succeed with no errors
Test error instantiation in browser console:
  - `new AuthError('auth/wrong-password', 'errors.auth.wrongPassword')`
  - Verify `instanceof AuthError` returns true
  - Verify `instanceof Error` returns true
Test i18n key resolution:
  - `$t('errors.auth.wrongPassword')` in Czech locale
  - `$t('errors.firestore.permissionDenied')` in English locale
</verification>

<success_criteria>
- Developer can import { AuthError, FirestoreError } from '@/errors' in any file
- Developer can catch errors and check `instanceof AuthError` to distinguish error types
- Czech and English error messages exist for all common Firebase failures
- Error mapper converts Firebase error codes to localized i18n keys
- TypeScript compilation succeeds with typed error classes
</success_criteria>

<output>
After completion, create `.planning/phases/01-error-system-foundation/01-01-SUMMARY.md`
</output>
